{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://cebus.dev/schemas/team-config.json",
  "title": "TeamConfig",
  "description": "Configuration for a Cebus agent team",
  "type": "object",
  "required": ["teamId", "mission", "agents"],
  "properties": {
    "teamId": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9-]+$",
      "minLength": 1,
      "maxLength": 64,
      "description": "Unique team identifier (alphanumeric + hyphens)"
    },
    "mission": {
      "type": "string",
      "minLength": 1,
      "maxLength": 2000,
      "description": "Team's overarching goal"
    },
    "orchestrationMode": {
      "type": "string",
      "enum": ["ai", "deterministic"],
      "default": "deterministic",
      "description": "Routing intelligence level"
    },
    "conversationMode": {
      "type": "string",
      "enum": ["dynamic", "tag_only", "sequential"],
      "default": "tag_only",
      "description": "Message routing strategy"
    },
    "agents": {
      "type": "array",
      "minItems": 1,
      "maxItems": 10,
      "description": "Agent definitions (1-10 agents)",
      "items": { "$ref": "#/definitions/AgentProfile" }
    },
    "defaultAgentId": {
      "type": "string",
      "description": "Fallback agent ID for ambiguous routing"
    },
    "orchestratorInstructions": {
      "type": "array",
      "items": { "type": "string", "minLength": 1 },
      "description": "Behavioral directives for the orchestrator"
    },
    "orchestratorContext": {
      "type": "array",
      "items": { "type": "string", "minLength": 1 },
      "description": "File paths loaded as orchestrator knowledge at compile time"
    },
    "aiRouting": { "$ref": "#/definitions/AIRoutingConfig" },
    "toolApproval": { "$ref": "#/definitions/ToolApprovalConfig" },
    "budgets": { "$ref": "#/definitions/BudgetConfig" },
    "compaction": { "$ref": "#/definitions/CompactionConfig" },
    "sessionPersistence": { "$ref": "#/definitions/PersistenceConfig" }
  },
  "definitions": {
    "AgentProfile": {
      "type": "object",
      "required": ["id", "name", "role", "instructions"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9-]+$",
          "minLength": 1,
          "maxLength": 32,
          "description": "Unique agent identifier within team"
        },
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Display name"
        },
        "role": {
          "type": "string",
          "minLength": 1,
          "maxLength": 500,
          "description": "Description of purpose"
        },
        "instructions": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "minLength": 1 },
          "description": "Behavioral directives"
        },
        "skills": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "description": "Routing tags for AI mode"
        },
        "mcpServers": {
          "type": "array",
          "items": { "$ref": "#/definitions/MCPServerConfig" },
          "description": "MCP tool server connections"
        },
        "model": {
          "type": "string",
          "minLength": 1,
          "description": "Model ID (e.g., 'gpt-5', 'claude-sonnet-4.5')"
        },
        "provider": { "$ref": "#/definitions/ProviderConfig" }
      }
    },
    "MCPServerConfig": {
      "type": "object",
      "required": ["id", "type"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-zA-Z0-9-]+$",
          "minLength": 1,
          "maxLength": 64,
          "description": "Unique server identifier within agent"
        },
        "type": {
          "type": "string",
          "enum": ["local", "http"],
          "description": "Transport type"
        },
        "command": {
          "type": "string",
          "minLength": 1,
          "description": "Executable path (required for local type)"
        },
        "args": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Command arguments for local transport"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "Server URL (required for http type)"
        },
        "headers": {
          "type": "object",
          "additionalProperties": { "type": "string" },
          "description": "HTTP headers for remote transport"
        },
        "tools": {
          "type": "array",
          "items": { "type": "string" },
          "default": ["*"],
          "description": "Tool whitelist ('*' for all)"
        },
        "timeout": {
          "type": "integer",
          "minimum": 1,
          "maximum": 300000,
          "default": 30000,
          "description": "Per-tool timeout in milliseconds"
        },
        "env": {
          "type": "object",
          "additionalProperties": { "type": "string" },
          "description": "Environment variables for local transport"
        }
      },
      "if": { "properties": { "type": { "const": "local" } } },
      "then": { "required": ["command"] },
      "else": {
        "if": { "properties": { "type": { "const": "http" } } },
        "then": { "required": ["url"] }
      }
    },
    "ProviderConfig": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["openai", "anthropic", "gemini", "ollama", "copilot"],
          "description": "AI provider type"
        },
        "apiKey": {
          "type": "string",
          "minLength": 1,
          "description": "API key (optional for ollama/copilot)"
        },
        "baseUrl": {
          "type": "string",
          "format": "uri",
          "description": "Custom endpoint URL"
        }
      }
    },
    "AIRoutingConfig": {
      "type": "object",
      "description": "Configuration for the AI routing LLM",
      "properties": {
        "provider": {
          "$ref": "#/definitions/ProviderConfig",
          "default": { "type": "ollama" }
        },
        "model": {
          "type": "string",
          "minLength": 1,
          "default": "llama3.2",
          "description": "Model ID for routing LLM"
        }
      }
    },
    "ToolApprovalConfig": {
      "type": "object",
      "description": "MCP tool permission tiers",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable tool approval"
        },
        "readOnly": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Always allowed tool patterns"
        },
        "write": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Allowed + logged tool patterns"
        },
        "dangerous": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Require human approval tool patterns"
        }
      }
    },
    "BudgetConfig": {
      "type": "object",
      "description": "Token and rate limits",
      "properties": {
        "maxTokensPerAgentPerSession": {
          "type": ["integer", "null"],
          "minimum": 1,
          "default": null,
          "description": "Max tokens per agent per session"
        },
        "maxTokensPerSession": {
          "type": ["integer", "null"],
          "minimum": 1,
          "default": null,
          "description": "Max total tokens per session"
        },
        "maxInvocationsPerMinute": {
          "type": ["integer", "null"],
          "minimum": 1,
          "default": null,
          "description": "Max invocations per agent per minute"
        }
      }
    },
    "CompactionConfig": {
      "type": "object",
      "description": "Conversation compaction settings",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable conversation compaction"
        },
        "checkpointInterval": {
          "type": "integer",
          "minimum": 1,
          "default": 20,
          "description": "Messages before compaction triggers"
        }
      }
    },
    "PersistenceConfig": {
      "type": "object",
      "description": "Session persistence settings",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable session persistence"
        },
        "directory": {
          "type": "string",
          "minLength": 1,
          "default": "~/.cebus/sessions",
          "description": "Session storage directory"
        }
      }
    }
  }
}
